async function t(){return await async function(){try{let t=localStorage.getItem("twitchToken");if(t){let n=await e(t);if(n&&n.login)return n.token=t,n}}catch(t){return null}}()||await async function(){try{const t=new URLSearchParams(location.hash.replace("#","")).get("access_token");if(t){let n=await e(t);if(n&&n.login){localStorage.setItem("twitchToken",t);const e=window.location.href.split("#")[0];return window.location.replace(e),n.token=t,n}}}catch(t){return null}}()}async function e(t){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${t}`}}).then(t=>t.json()).catch(t=>({error:t}))}let n={UserId:0,User:"",Token:"",Scopes:[],Logout:function(){localStorage.removeItem("twitchToken")},Login:function(t,e,n=["user:read:email"]){window.location.href=`https://id.twitch.tv/oauth2/authorize?client_id=${t}&redirect_uri=${e}&response_type=token&scope=${n.join(" ")}`},Check:async function(e){let o=await t();return o?(n.UserId=o.user_id,n.User=o.login,n.Token=o.token,n.Scopes=o.scopes):(n.Logout(),e&&(window.location.href=e)),o},GetUser:async function(t,e){return await fetch(`https://api.twitch.tv/helix/users?id=${e}`,{headers:{"Client-ID":t}}).then(t=>t.json()).then(t=>t.data.length>0?t.data[0]:{}).catch(t=>({error:t}))}};window.ComfyTwitch=n;